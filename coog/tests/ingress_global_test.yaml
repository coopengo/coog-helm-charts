# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: Test global ingress version < 1.19.0
release:
  name: test # Do not edit
  namespace: test
capabilities:
  majorVersion: 1
  minorVersion: 18
tests:
  - it: Test coog
    template: coog/ingress.yaml
    set:
      ingress:
        host: test.local
    asserts:
      - contains:
          path: spec.rules
          content:
            host: test.local
            http:
              paths:
              - path: "/"
                backend:
                  servicename: test-coog
                  servicePort: 80


  - it: Test b2b
    template: b2b/ingress.yaml
    set:
      ingress:
        host: test.local
      b2b:
        enabled: true
    asserts:
      - contains:
          path: spec.rules
          content:
            host: test.local
            http:
              paths:
              - path: "/portal(/|$)(.*)"
                backend:
                  servicename: test-coog-b2b
                  servicePort: 80


  - it: Test b2c
    template: b2c/ingress.yaml
    set:
      ingress:
        host: test.local
      b2c:
        enabled: true
    asserts:
      - contains:
          path: spec.rules
          content:
            host: test.local
            http:
              paths:
              - path: "/customers/myspace(/|$)(.*)"
                backend:
                  servicename: test-coog-b2c
                  servicePort: 80


  - it: Test customer-backend
    template: customer-backend/ingress.yaml
    set:
      ingress:
        host: test.local
      customerBackend:
        enabled: true
    asserts:
      - contains:
          path: spec.rules
          content:
            host: test.local
            http:
              paths:
              - path: "/v1/customer(/|$)(.*)"
                backend:
                  servicename: test-coog-customer-backend
                  servicePort: 80


  - it: Test customer-frontend
    template: customer-frontend/ingress.yaml
    set:
      ingress:
        host: test.local
      customerFrontend:
        enabled: true
    asserts:
      - contains:
          path: spec.rules
          content:
            host: test.local
            http:
              paths:
              - path: "/customer(/|$)(.*)"
                backend:
                  servicename: test-coog-customer-frontend
                  servicePort: 80


  - it: Test gateway
    template: gateway/ingress.yaml
    set:
      ingress:
        host: test.local
      frontCore:
        enabled: true
    asserts:
      - contains:
          path: spec.rules
          content:
            host: test.local
            http:
              paths:
              - path: "/gateway(/|$)(.*)"
                backend:
                  servicename: test-coog-gateway
                  servicePort: 80


  - it: Test static
    template: static/ingress.yaml
    set:
      ingress:
        host: test.local
    asserts:
      - contains:
          path: spec.rules
          content:
            host: test.local
            http:
              paths:
              - path: "/sao"
                backend:
                  servicename: test-coog-static
                  servicePort: 80
              - path: "/bench"
                backend:
                  servicename: test-coog-static
                  servicePort: 80
              - path: "/doc"
                backend:
                  servicename: test-coog-static
                  servicePort: 80
